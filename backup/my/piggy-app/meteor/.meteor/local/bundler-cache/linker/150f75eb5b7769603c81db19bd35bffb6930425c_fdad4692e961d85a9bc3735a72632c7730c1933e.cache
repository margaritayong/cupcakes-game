[{"type":"js","data":"/* Imports for global scope */\n\nMongoInternals = Package.mongo.MongoInternals;\nMongo = Package.mongo.Mongo;\nReactiveVar = Package['reactive-var'].ReactiveVar;\nTracker = Package.tracker.Tracker;\nDeps = Package.tracker.Deps;\nECMAScript = Package.ecmascript.ECMAScript;\nReactMeteorData = Package['react-meteor-data'].ReactMeteorData;\nMeteor = Package.meteor.Meteor;\nglobal = Package.meteor.global;\nmeteorEnv = Package.meteor.meteorEnv;\nWebApp = Package.webapp.WebApp;\nWebAppInternals = Package.webapp.WebAppInternals;\nmain = Package.webapp.main;\n_ = Package.underscore._;\nDDP = Package['ddp-client'].DDP;\nDDPServer = Package['ddp-server'].DDPServer;\nLaunchScreen = Package['launch-screen'].LaunchScreen;\nBlaze = Package.ui.Blaze;\nUI = Package.ui.UI;\nHandlebars = Package.ui.Handlebars;\nSpacebars = Package.spacebars.Spacebars;\nmeteorInstall = Package.modules.meteorInstall;\nmeteorBabelHelpers = Package['babel-runtime'].meteorBabelHelpers;\nPromise = Package.promise.Promise;\nAutoupdate = Package.autoupdate.Autoupdate;\nHTML = Package.htmljs.HTML;\n\n","servePath":"/packages/global-imports.js"},{"type":"js","data":"var require = meteorInstall({\"imports\":{\"api\":{\"coders.js\":function(require,exports,module){\n\n///////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                       //\n// imports/api/coders.js                                                                 //\n//                                                                                       //\n///////////////////////////////////////////////////////////////////////////////////////////\n                                                                                         //\nmodule.export({\n  Coders: () => Coders\n});\nlet Mongo;\nmodule.watch(require(\"meteor/mongo\"), {\n  Mongo(v) {\n    Mongo = v;\n  }\n\n}, 0);\nlet check;\nmodule.watch(require(\"meteor/check\"), {\n  check(v) {\n    check = v;\n  }\n\n}, 1);\nconst Coders = new Mongo.Collection('coders');\n\nif (Meteor.isServer) {\n  // This code only runs on the server\n  Meteor.publish('coders', function codersPublication() {\n    return Coders.find({});\n  });\n} // http://docs.meteor.com/api/collections.html#Mongo-Collection-upsert\n\n\nMeteor.methods({\n  'coders.upsert'(name) {\n    Coders.upsert({\n      name: name\n    }, {\n      $set: {\n        name: name,\n        updatedAt: new Date()\n      }\n    });\n  }\n\n});\n///////////////////////////////////////////////////////////////////////////////////////////\n\n},\"led.js\":function(require,exports,module){\n\n///////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                       //\n// imports/api/led.js                                                                    //\n//                                                                                       //\n///////////////////////////////////////////////////////////////////////////////////////////\n                                                                                         //\nmodule.export({\n  Led: () => Led\n});\nlet Mongo;\nmodule.watch(require(\"meteor/mongo\"), {\n  Mongo(v) {\n    Mongo = v;\n  }\n\n}, 0);\nlet check;\nmodule.watch(require(\"meteor/check\"), {\n  check(v) {\n    check = v;\n  }\n\n}, 1);\nconst Led = new Mongo.Collection('led');\n\nif (Meteor.isServer) {\n  // This code only runs on the server\n  Meteor.publish('led', function ledPublication() {\n    return Led.find({});\n  });\n} // http://docs.meteor.com/api/collections.html#Mongo-Collection-upsert\n\n\nMeteor.methods({\n  'led.insert'(pixels) {}\n\n});\n///////////////////////////////////////////////////////////////////////////////////////////\n\n}}},\"server\":{\"main.js\":function(require,exports,module){\n\n///////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                       //\n// server/main.js                                                                        //\n//                                                                                       //\n///////////////////////////////////////////////////////////////////////////////////////////\n                                                                                         //\nmodule.export({\n  config: () => config,\n  client: () => client\n});\nlet Meteor;\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\nlet Led;\nmodule.watch(require(\"../imports/api/led.js\"), {\n  default(v) {\n    Led = v;\n  }\n\n}, 1);\nlet Goal;\nmodule.watch(require(\"../imports/api/coders.js\"), {\n  default(v) {\n    Goal = v;\n  }\n\n}, 2);\nlet connect;\nmodule.watch(require(\"mqtt/lib/connect\"), {\n  connect(v) {\n    connect = v;\n  }\n\n}, 3);\nlet SerialPort;\nmodule.watch(require(\"serialport\"), {\n  default(v) {\n    SerialPort = v;\n  }\n\n}, 4);\n\nconst rgbHex = require('rgb-hex');\n\nconst Readline = SerialPort.parsers.Readline;\nconst parser = new Readline();\nvar port = new SerialPort('/dev/cu.usbmodem1431', {\n  baudRate: 9600\n});\nport.pipe(parser); // parse the data from serial into meaningful objects\n\nfunction onData(data) {\n  console.log(\"meteor onData: \" + data); // send the character over mqtt\n  // client.publish(\"led\", text);\n} // setup the callback for the parser\n// our callback function must be wrapped in Meteor.bindEnvironment to avoid Fiber errors\n\n\nparser.on('data', Meteor.bindEnvironment(onData)); // setup the callback for the port\n// Open errors will be emitted as an error event\n\nport.on('error', function (err) {\n  console.log('Error: ', err.message);\n}); // heres wehre you type in your name\n// serial event\n\nfunction writeSerialData(data) {\n  var buffer = Buffer.from(data);\n  port.write(data, function (err) {\n    if (err) {\n      return console.log('Error on write: ', err.message);\n    }\n\n    console.log('meteor wrote', data);\n  });\n}\n\nfunction saveCoderInDataBase(targetGoal) {\n  Meteor.call('coders.upsert', targetGoal);\n} // meteor\n\n\nMeteor.methods({\n  'serial.write'(pixels) {\n    // global ok?\n    var message = \"\"; // get RGB from hex data\n\n    var hexValue = rgbHex(pixels[0], pixels[1], pixels[2]);\n    message = hexValue;\n    writeSerialData(message + '|'); // write data to the port\n\n    client.publish(\"ledgrid\", message); // publish via mqtt\n  },\n\n  'send.goal'(targetGoal) {\n    console.log(\"Meteor send.goal\", targetGoal);\n    client.publish(\"targetGoal\", targetGoal); // publish via mqtt\n  }\n\n}); // MQTT\n\nconst config = {\n  mqttHost: \"mqtt://127.0.0.1\",\n  mqttPort: 1883\n};\nconst client = connect(config.mqttHost);\n\nfunction onMessage(topic, message) {\n  if (topic === \"targetGoal\") {\n    console.log(\"message\", message.toString());\n    Meteor.call('coders.upsert', targetGoal);\n  }\n} // client callback\n\n\nclient.on('message', Meteor.bindEnvironment(onMessage));\nclient.on(\"connect\", function () {\n  console.log(\"---- mqtt client connected ----\");\n  client.subscribe(\"ledgrid\"); // subscribe to the ledgrid topic\n\n  client.subscribe(\"targetGoal\");\n});\nMeteor.startup(() => {// code to run on server at startup\n});\n///////////////////////////////////////////////////////////////////////////////////////////\n\n}}},{\n  \"extensions\": [\n    \".js\",\n    \".json\",\n    \".jsx\"\n  ]\n});\nrequire(\"./server/main.js\");","servePath":"/app.js","sourceMap":{"version":3,"sources":["imports/api/coders.js","imports/api/led.js","server/main.js"],"names":["module","export","Coders","Mongo","watch","require","v","check","Collection","Meteor","isServer","publish","codersPublication","find","methods","name","upsert","$set","updatedAt","Date","Led","ledPublication","pixels","config","client","default","Goal","connect","SerialPort","rgbHex","Readline","parsers","parser","port","baudRate","pipe","onData","data","console","log","on","bindEnvironment","err","message","writeSerialData","buffer","Buffer","from","write","saveCoderInDataBase","targetGoal","call","hexValue","mqttHost","mqttPort","onMessage","topic","toString","subscribe","startup"],"mappings":"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","file":"/app.js","sourcesContent":["import { Mongo } from 'meteor/mongo';\nexport const Coders = new Mongo.Collection('coders');\nimport { check } from 'meteor/check';\n\n\nif (Meteor.isServer) {\n  // This code only runs on the server\n  Meteor.publish('coders', function codersPublication() {\n    return Coders.find({});\n  });\n}\n\n// http://docs.meteor.com/api/collections.html#Mongo-Collection-upsert\nMeteor.methods({\n  'coders.upsert'(name) {\n\n    Coders.upsert({\n      name: name\n    },\n    {\n      $set: {\n        name: name,\n        updatedAt: new Date(),\n      }\n    });\n  }\n})","import { Mongo } from 'meteor/mongo';\nexport const Led = new Mongo.Collection('led');\nimport { check } from 'meteor/check';\n\n\nif (Meteor.isServer) {\n  // This code only runs on the server\n  Meteor.publish('led', function ledPublication() {\n    return Led.find({});\n  });\n}\n\n// http://docs.meteor.com/api/collections.html#Mongo-Collection-upsert\nMeteor.methods({\n  'led.insert'(pixels) {\n    \n  }\n})","import { Meteor } from 'meteor/meteor';\nimport Led from '../imports/api/led.js'\nimport Goal from '../imports/api/coders.js'\nimport { connect } from 'mqtt/lib/connect';\nimport SerialPort from 'serialport';\nconst rgbHex = require('rgb-hex');\n \nconst Readline = SerialPort.parsers.Readline;\nconst parser = new Readline();\nvar port = new SerialPort('/dev/cu.usbmodem1431', {\n  baudRate: 9600\n});\nport.pipe(parser);\n\n\n// parse the data from serial into meaningful objects\nfunction onData(data) {\n  console.log(\"meteor onData: \" + data);\n  \n  // send the character over mqtt\n  // client.publish(\"led\", text);\n}\n\n// setup the callback for the parser\n// our callback function must be wrapped in Meteor.bindEnvironment to avoid Fiber errors\nparser.on('data', Meteor.bindEnvironment(onData));\n\n// setup the callback for the port\n// Open errors will be emitted as an error event\nport.on('error', function(err) {\n  console.log('Error: ', err.message);\n})\n\n// heres wehre you type in your name\n\n\n// serial event\nfunction writeSerialData(data) {\n  var buffer = Buffer.from(data);\n\n  port.write(data, function(err) {\n    if (err) {\n      return console.log('Error on write: ', err.message);\n    }\n    console.log('meteor wrote', data);\n  });\n\n}\n\nfunction saveCoderInDataBase(targetGoal) {\n  Meteor.call('coders.upsert', targetGoal);\n}\n\n// meteor\nMeteor.methods({\n  'serial.write'(pixels) {\n\n    // global ok?\n    var message = \"\";\n\n    // get RGB from hex data\n    var hexValue = rgbHex(pixels[0], pixels[1], pixels[2]);\n\n    message = hexValue;\n\n    writeSerialData(message + '|'); // write data to the port\n    client.publish(\"ledgrid\", message); // publish via mqtt\n    \n  },\n  'send.goal'(targetGoal) {\n\n    console.log(\"Meteor send.goal\", targetGoal);\n    client.publish(\"targetGoal\", targetGoal); // publish via mqtt\n\n  }\n})\n\n \n// MQTT\nexport const config = {\n  mqttHost: \"mqtt://127.0.0.1\",\n  mqttPort: 1883\n};\n\nexport const client = connect(config.mqttHost);\n\nfunction onMessage(topic, message) {\n  if (topic === \"targetGoal\") {\n    console.log(\"message\", message.toString());\n    Meteor.call('coders.upsert', targetGoal);\n  }\n}\n\n// client callback\nclient.on('message', Meteor.bindEnvironment(onMessage));\n\nclient.on(\"connect\", function() {\n  console.log(\"---- mqtt client connected ----\");\n  client.subscribe(\"ledgrid\"); // subscribe to the ledgrid topic\n  client.subscribe(\"targetGoal\");\n})\n\nMeteor.startup(() => {\n  // code to run on server at startup\n});\n"]}}]